version: '3.3'

services:
  faq-front:
    build:
      context: ./front
      dockerfile: Dockerfile
      args:
          - http_proxy=$http_proxy
          - https_proxy=$http_proxy
    container_name: faq-front
    networks:
      - web
      - backend
    ports:
      - 25252:80
    volumes:
      - './front/sources/:/app:rw'
      - './protos/:/app/protos:ro'
    tty: true

  faq-grpc:
    build:
      context: ./grpc
      dockerfile: Dockerfile
      args:
          - http_proxy=$http_proxy
          - https_proxy=$http_proxy
    networks:
      - backend
    container_name: faq-grpc
    env_file:
      - .env
    volumes:
      - './grpc/sources/:/app:rw'
      - './protos/:/app/protos:rw'
    tty: true

  faq-api:
    build:
      context: ./api
      dockerfile: Dockerfile
      args:
          - http_proxy=$http_proxy
          - https_proxy=$http_proxy
    container_name: faq-api
    networks:
      - backend
      - dbnw
    env_file:
      - .env
    volumes:
      - './api/sources/:/app:ro'
    tty: true

  faq-db:
    build:
      context: ./db
      dockerfile: Dockerfile
      args:
          - http_proxy=$http_proxy
          - https_proxy=$http_proxy
    networks:
      - dbnw
    container_name: faq-db
    volumes:
      - 'faq_vol:/var/lib/mysql:rw'
    labels:
      # traefik で監視・リバースプロキシしない
      - 'traefik.enable=false'
    ports:
      - 3306:3306
    tty: true
    env_file:
      - .env

volumes:
  faq_vol:

networks:
  dbnw:
  web:
  backend:
